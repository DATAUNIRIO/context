# Wellbeing Measures  {#wellbeing}

djalmapessoa_look do any of the other functions need to be moved to this wellbeing chapter?


## The Gender Pay Gap (svygpg)



For additional usage examples of `svygpg`, type `?convey::svygpg` in the R console.


here are the references


[@osier2009] and [@deville1999]



## Quintile Share Ratio (svyqsr)


here are the references

[@osier2009] and [@deville1999]

---

**A replication example**

The R `vardpoor` package [@vardpoor], created by researchers at the Central Statistical Bureau of Latvia, includes a qsr coefficient calculation using the ultimate cluster method.  The example below reproduces those statistics.

Load and prepare the same data set:

```{r}
# load the convey package
library(convey)

# load the survey library
library(survey)

# load the vardpoor library
library(vardpoor)

# load the synthetic european union statistics on income & living conditions
data(eusilc)

# make all column names lowercase
names( eusilc ) <- tolower( names( eusilc ) )

# add a column with the row number
dati <- data.table(IDd = 1 : nrow(eusilc), eusilc)

# calculate the qsr coefficient
# using the R vardpoor library
varpoord_qsr_calculation <-
	varpoord(
	
		# analysis variable
		Y = "eqincome", 
		
		# weights variable
		w_final = "rb050",
		
		# row number variable
		ID_level1 = "IDd",
		
		# strata variable
		H = "db040", 
		
		N_h = NULL ,
		
		# clustering variable
		PSU = "rb030", 
		
		# data.table
		dataset = dati, 
		
		# qsr coefficient function
		type = "linqsr"
		
	)

# all calculations produced by vardpoor::linqsr
varpoord_qsr_calculation$all_result

# construct a survey.design
# using our recommended setup
des_eusilc <- 
	svydesign( 
		ids = ~ rb030 , 
		strata = ~ db040 ,  
		weights = ~ rb050 , 
		data = eusilc
	)

# immediately run the convey_prep function on it
des_eusilc <- convey_prep( des_eusilc )

# coefficients do match
varpoord_qsr_calculation$all_result$value
coef( svyqsr( ~ eqincome , des_eusilc ) )

# variances do not match exactly
attr( svyqsr( ~ eqincome , des_eusilc ) , 'var' )
varpoord_qsr_calculation$all_result$var

# standard errors do not match exactly
varpoord_qsr_calculation$all_result$se
SE( svyqsr( ~ eqincome , des_eusilc ) )
```

By default, the `convey::svyqsr` function comes close to the results of `vardpoor::linqsr`.  However, the measures of uncertainty do not line up, because `library(vardpoor)` defaults to the ultimate cluster method.  This can be replicated with an alternative setup of the `survey.design` object.

```{r}
# within each strata, sum up the weights
cluster_sums <- aggregate( eusilc$rb050 , list( eusilc$db040 ) , sum )

# name the within-strata sums of weights the `cluster_sum`
names( cluster_sums ) <- c( "db040" , "cluster_sum" )

# merge this column back onto the data.frame
eusilc <- merge( eusilc , cluster_sums )

# construct a survey.design
# with the fpc using the cluster sum
des_eusilc_ultimate_cluster <- 
	svydesign( 
		ids = ~ rb030 , 
		strata = ~ db040 ,  
		weights = ~ rb050 , 
		data = eusilc , 
		fpc = ~ cluster_sum 
	)

# again, immediately run the convey_prep function on the `survey.design`
des_eusilc_ultimate_cluster <- convey_prep( des_eusilc_ultimate_cluster )

# matches
attr( svyqsr( ~ eqincome , des_eusilc_ultimate_cluster ) , 'var' )
varpoord_qsr_calculation$all_result$var

# matches
varpoord_qsr_calculation$all_result$se
SE( svyqsr( ~ eqincome , des_eusilc_ultimate_cluster ) )
```



For additional usage examples of `svyqsr`, type `?convey::svyqsr` in the R console.

